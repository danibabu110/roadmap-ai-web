<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roadmap AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white h-screen flex">

<aside class="w-64 bg-gray-800 p-4">
  <h1 class="text-xl font-bold mb-4">Roadmap AI</h1>
  <div id="skills-list">Loading skills...</div>
</aside>

<main class="flex-1 p-6">
  <h2 id="current-skill-title" class="text-2xl mb-4">Select Skill</h2>
  <div id="roadmap-container"></div>
</main>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyD4OUurLMulKg1-UPB92bYJBoo8_zkrHz8",
  authDomain: "fake-news-detector-4f585.firebaseapp.com",
  projectId: "fake-news-detector-4f585",
  storageBucket: "fake-news-detector-4f585.firebasestorage.app",
  messagingSenderId: "87660438732",
  appId: "1:87660438732:web:3e56fd10a9ab54b2a04e69"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

onAuthStateChanged(auth,(user)=>{
  if(!user){
    window.location.href="/login.html";
    return;
  }
  fetchSkills();
});

const API_BASE="/api";

async function fetchSkills(){
  const res=await fetch(API_BASE+"/skills");
  const skills=await res.json();

  const list=document.getElementById("skills-list");
  list.innerHTML="";

  skills.forEach(skill=>{
    const btn=document.createElement("button");
    btn.className="block w-full text-left p-2 hover:bg-gray-700";
    btn.innerText=skill;
    btn.onclick=()=>loadRoadmap(skill);
    list.appendChild(btn);
  });
}

async function loadRoadmap(skill){
  document.getElementById("current-skill-title").innerText=skill;

  const res=await fetch(API_BASE+"/generate",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({skill})
  });

  const data=await res.json();

  const container=document.getElementById("roadmap-container");
  container.innerHTML="";

  data.roadmap.nodes.forEach(n=>{
    const div=document.createElement("div");
    div.className="p-3 bg-gray-800 rounded mb-2";
    div.innerText=n;
    container.appendChild(div);
  });
}

</script>
</body>
</html>