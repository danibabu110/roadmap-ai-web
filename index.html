<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roadmap AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white h-screen flex">

<!-- SIDEBAR -->
<aside class="w-64 bg-gray-800 p-4">
<h1 class="text-xl mb-4">Roadmap AI</h1>
<div id="skills-list">Loading skills...</div>
</aside>

<!-- MAIN -->
<main class="flex-1 p-6">
<h2 id="current-skill-title">Select Skill</h2>
<div id="roadmap-container" class="mt-4 space-y-2"></div>
</main>

<!-- RIGHT PANEL -->
<aside class="w-96 bg-gray-800 p-4 flex flex-col">
<h3 id="node-title">Topic Info</h3>
<div id="node-explain-content" class="text-sm mt-2 flex-1 overflow-auto">
Click roadmap node
</div>

<div class="mt-4">
<input id="chat-input" class="w-full p-2 bg-gray-700 rounded" placeholder="Ask AI mentor...">
<button id="send-btn" class="mt-2 bg-blue-600 px-3 py-1 rounded">Send</button>
<div id="chat-messages" class="mt-2 text-sm"></div>
</div>
</aside>

<script>
const API_BASE = window.location.origin + "/api";

const dom={
skills:document.getElementById("skills-list"),
roadmap:document.getElementById("roadmap-container"),
title:document.getElementById("current-skill-title"),
nodeTitle:document.getElementById("node-title"),
nodeExplain:document.getElementById("node-explain-content"),
chatInput:document.getElementById("chat-input"),
chatMessages:document.getElementById("chat-messages")
};

async function fetchSkills(){
const res=await fetch(API_BASE+"/skills");
const skills=await res.json();

dom.skills.innerHTML="";
skills.forEach(s=>{
let b=document.createElement("button");
b.className="block w-full text-left p-2 hover:bg-gray-700";
b.innerText=s;
b.onclick=()=>loadRoadmap(s);
dom.skills.appendChild(b);
});
}

async function loadRoadmap(skill){

dom.title.innerText=skill;

const res=await fetch(API_BASE+"/generate",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({skill})
});

const data=await res.json();

dom.roadmap.innerHTML="";

data.roadmap.nodes.forEach(n=>{
let b=document.createElement("button");
b.className="w-full bg-gray-700 p-2 rounded";
b.innerText=n;
b.onclick=()=>loadNode(n);
dom.roadmap.appendChild(b);
});
}

async function loadNode(node){

dom.nodeTitle.innerText=node;

const explain=await fetch(API_BASE+"/explain",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({topic:node})
});
const exp=await explain.json();

const cert=await fetch(API_BASE+"/node-certs",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({node})
});
const certs=await cert.json();

let html=`<p>${exp.explanation}</p>
<h4 class="mt-3 text-blue-400">Free Certifications</h4>`;

certs.free_certifications.forEach(c=>{
html+=`<a href="${c.url}" target="_blank" class="block bg-gray-700 p-2 mt-1 rounded">${c.title}</a>`;
});

html+=`<h4 class="mt-3 text-green-400">Industry Certifications</h4>`;

certs.industry_certifications.forEach(c=>{
html+=`<a href="${c.url}" target="_blank" class="block bg-gray-700 p-2 mt-1 rounded">${c.title}</a>`;
});

dom.nodeExplain.innerHTML=html;
}

document.getElementById("send-btn").onclick=async()=>{
const msg=dom.chatInput.value;
if(!msg)return;

dom.chatMessages.innerHTML+=`<div>You: ${msg}</div>`;
dom.chatInput.value="";

const res=await fetch(API_BASE+"/chat",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({question:msg})
});

const data=await res.json();
dom.chatMessages.innerHTML+=`<div>AI: ${data.reply}</div>`;
};

fetchSkills();
</script>

</body>
</html>