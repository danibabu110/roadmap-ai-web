<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Roadmap AI</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white flex h-screen">

<aside class="w-64 bg-gray-800 p-4">
<h1 class="text-xl mb-4">Roadmap AI</h1>
<div id="skills-list">Loading...</div>
</aside>

<main class="flex-1 p-6">
<h2 id="current-skill-title">Select Skill</h2>
<div id="roadmap-container" class="mt-4"></div>
</main>

<aside class="w-96 bg-gray-800 p-4">
<h3 id="node-title">Topic Info</h3>
<div id="node-explain-content">Click node</div>

<div class="mt-4">
<input id="chat-input" class="w-full bg-gray-700 p-2 rounded">
<button id="send-btn" class="mt-2 bg-blue-600 px-3 py-1 rounded">
Send
</button>
<div id="chat-messages" class="mt-2"></div>
</div>
</aside>

<script>

const API_BASE = window.location.origin + "/api";

const dom={
skillsList:document.getElementById("skills-list"),
roadmap:document.getElementById("roadmap-container"),
skillTitle:document.getElementById("current-skill-title"),
nodeTitle:document.getElementById("node-title"),
nodeExplain:document.getElementById("node-explain-content"),
chatInput:document.getElementById("chat-input"),
chatMessages:document.getElementById("chat-messages")
};

async function fetchSkills(){
const res=await fetch(API_BASE+"/skills");
const skills=await res.json();

dom.skillsList.innerHTML="";
skills.forEach(s=>{
let b=document.createElement("button");
b.innerText=s;
b.className="block p-2 hover:bg-gray-700 w-full text-left";
b.onclick=()=>loadRoadmap(s);
dom.skillsList.appendChild(b);
});
}

async function loadRoadmap(skill){

dom.skillTitle.innerText=skill;

const res=await fetch(API_BASE+"/generate",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({skill})
});

const data=await res.json();

dom.roadmap.innerHTML="";

data.roadmap.nodes.forEach(n=>{
let b=document.createElement("button");
b.className="block bg-gray-700 p-2 rounded mb-2 w-full";
b.innerText=n;
b.onclick=()=>loadNode(n);
dom.roadmap.appendChild(b);
});
}

async function loadNode(node){

dom.nodeTitle.innerText=node;

const explainRes=await fetch(API_BASE+"/explain",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({topic:node})
});

const explainData=await explainRes.json();

const certRes=await fetch(API_BASE+"/node-certs",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({node})
});

const certData=await certRes.json();

let html=`<p>${explainData.explanation}</p>
<h4 class='mt-3 text-blue-400'>Free Certifications</h4>`;

certData.free_certifications.forEach(c=>{
html += `<a href="${c.url}" target="_blank" class="block bg-gray-700 p-2 mt-1 rounded">${c.title}</a>`;
});

html += `<h4 class='mt-3 text-green-400'>Industry Certifications</h4>`;

certData.industry_certifications.forEach(c=>{
html += `<a href="${c.url}" target="_blank" class="block bg-gray-700 p-2 mt-1 rounded">${c.title}</a>`;
});

dom.nodeExplain.innerHTML=html;
}

document.getElementById("send-btn").onclick=async()=>{

const msg=dom.chatInput.value;
if(!msg)return;

dom.chatMessages.innerHTML+=`<div>You: ${msg}</div>`;
dom.chatInput.value="";

const res=await fetch(API_BASE+"/chat",{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({question:msg})
});

const data=await res.json();

dom.chatMessages.innerHTML+=`<div>AI: ${data.reply}</div>`;
};

fetchSkills();

</script>
</body>
</html>