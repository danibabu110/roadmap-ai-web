<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roadmap AI Mentor</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900 text-white h-screen flex">

<!-- Sidebar -->
<div class="w-64 bg-gray-800 p-4 overflow-y-auto">
<h1 class="text-xl font-bold text-blue-400 mb-4">Roadmap AI</h1>
<div id="skills-list">Loading skills...</div>
</div>

<!-- Main -->
<div class="flex-1 flex flex-col">
<header class="p-4 border-b border-gray-700 text-xl" id="title">
Select Skill
</header>

<div class="flex-1 overflow-y-auto p-6" id="roadmap">
Select a skill to begin.
</div>
</div>

<!-- Right Panel -->
<div class="w-96 bg-gray-800 flex flex-col border-l border-gray-700">

<div class="p-4 border-b border-gray-700">
<h2 id="node-title" class="text-blue-400 font-bold">Topic Info</h2>
</div>

<div id="node-info" class="p-4 flex-1 overflow-y-auto text-sm text-gray-300">
Click a node.
</div>

<div class="p-3 border-t border-gray-700">
<input id="chat-input" class="w-full p-2 rounded bg-gray-700" placeholder="Ask AI mentor...">
<button id="send-btn" class="mt-2 w-full bg-blue-600 p-2 rounded">Send</button>
</div>

<div id="chat-box" class="p-3 text-sm overflow-y-auto h-48"></div>

</div>

<script>
const API="/api";

const skillsList=document.getElementById("skills-list");
const roadmap=document.getElementById("roadmap");
const title=document.getElementById("title");
const nodeInfo=document.getElementById("node-info");
const nodeTitle=document.getElementById("node-title");
const chatInput=document.getElementById("chat-input");
const chatBox=document.getElementById("chat-box");

async function fetchSkills(){
 const r=await fetch(API+"/skills");
 const skills=await r.json();
 skillsList.innerHTML="";
 skills.forEach(s=>{
   const b=document.createElement("button");
   b.className="block w-full text-left p-2 hover:bg-gray-700 rounded capitalize";
   b.innerText=s;
   b.onclick=()=>loadRoadmap(s);
   skillsList.appendChild(b);
 });
}

async function loadRoadmap(skill){
 title.innerText=skill;
 roadmap.innerHTML="Loading...";
 const r=await fetch(API+"/generate",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({skill})
 });
 const data=await r.json();

 roadmap.innerHTML="";
 data.roadmap.nodes.forEach(n=>{
   const btn=document.createElement("button");
   btn.className="block w-full mb-2 p-3 bg-gray-800 hover:bg-gray-700 rounded";
   btn.innerText=n;
   btn.onclick=()=>loadNode(n);
   roadmap.appendChild(btn);
 });
}

async function loadNode(node){
 nodeTitle.innerText=node;
 nodeInfo.innerText="Loading AI...";

 const r=await fetch(API+"/explain",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({topic:node})
 });

 const data=await r.json();
 nodeInfo.innerText=data.explanation;
}

document.getElementById("send-btn").onclick=async()=>{
 const msg=chatInput.value.trim();
 if(!msg) return;

 chatBox.innerHTML+=`<div class="mb-2 text-blue-300">You: ${msg}</div>`;
 chatInput.value="";

 const r=await fetch(API+"/chat",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({question:msg})
 });

 const data=await r.json();
 chatBox.innerHTML+=`<div class="mb-2 text-gray-300">AI: ${data.reply}</div>`;
 chatBox.scrollTop=chatBox.scrollHeight;
};

fetchSkills();
</script>

</body>
</html>
